distname=$(echo vanilla)
arg1=$(echo $1 | sed 's,^$,.,')
arg3=$(echo $3 | sed 's,^$,.,')
csdb=$(cat $arg1)
entryname=$(echo $2)
entry=$(echo "$csdb" | grep '^'$entryname' ' | head -n1)
prefix=$(echo $entry | cut -d' ' -f2 | head -n1)
sprefix=$(echo "$csdb" | grep '^cfg_sprefix ' | cut -d' ' -f2- | head -n1)
pprefix=$(echo "$csdb" | grep '^cfg_pprefix ' | cut -d' ' -f2- | head -n1)
rprefix=$(echo $entry | cut -d' ' -f3)
hostname=$(echo $entry | cut -d' ' -f4)
port=$(echo $entry | cut -d' ' -f5)
user=$(echo $entry | cut -d' ' -f6)
pkeyformat=$(echo "$csdb" | grep '^cfg_pkeyformat ' | cut -d' ' -f2- | head -n1)
pkey=$(echo "$csdb" | grep '^'$pkeyformat$entryname' ' | cut -d' ' -f2- | head -n1)
cscmd=$(echo "$arg3")
fwdruleset=$(echo "$csdb" | grep "^\(lf\|rf\)_$entryname" | sed "s,::,:$hostname:," | sed "s,^lf_$entryname ,-L ," | sed "s,^rf_$entryname ,-R ," | tr '\n' ' ')
keyfile=$(echo $arg3)
pathbase=$(echo $4)
fsource=$(echo $arg3)
fdest=$(echo $4)
xline=$(echo $arg3)
dpyname=$(echo $arg3)
lport=$(echo "$csdb" | grep '^listen_'$entryname' ' | cut -d' ' -f2 | head -n1)
entryline=$(echo "$csdb" | grep -n .| grep '^[0-9]*:'$entryname' ' | cut -d: -f1 | head -n1)
keystring=$(cat $arg3)
dbfile=$(echo $arg1)
q86e=$(echo qemu-system-x86 -machine q35 -cpu max -accel kvm -device virtio-net-pci,netdev=unet -net user,id=unet -device virtio-scsi-pci)
q86root=$(echo sudo $q86e)
runpath=$(echo "${csdb}" | grep '^cfg_runpath ' | cut -d' ' -f2- | sed 's,/ *\?$,,')
cmdname=$(echo "$csdb" | grep '^cfg_launch ' | cut -d' ' -f2-)
#!/bin/sh
#sabre: Sidearmconnect-Box Restricted Environment
#Sabre is a non-root, improved implementation of sidearmconnect.
#howto: (1) create prefix specification file(echo . > prefix) (2) create rprefix(remote prefix) to connect to remote, or create sprefix(sys-prefix) to automate ssh key registration
#prefix is the installation directory(where sabre data directory-'sidearmconnect'-will be generated), sprefix is where a user's .ssh is located, rprefix is the prefix of the remote instance of sabre.
#NOTE: every prefix should not contain trailing slash(es); They may cause errors. To filter out the slashes automatically, pipe stdout into "sed 's,/$,,'"
#example: echo . > prefix ; echo /home/user-example > sprefix ; echo /home/user-remote/endure > rprefix
#usage: [script path] [hostkey(private)]
#sprefix=$(cat sprefix)
#pprefix=$(cat pprefix)
#pathbase=$4
#set pathbase to $(pwd) or $PWD in order to specify relative path
#with empty pathbase, the absolute path provided by $1 will be used
#to configure with absolute path, exclude preceding '/' (root directory representation) from the pathbase ($2) argument.
mkdir $pprefix
mkdir $pprefix/prefix.d
mkdir $prefix
mkdir $prefix/sidearmconnect
chmod -R 755 $prefix/sidearmconnect
rm $prefix/sidearmconnect/sacsshhkey/key
rm $prefix/sidearmconnect/sacsshpkey/key
# this extension will be installed on user directory.
mkdir $prefix/sidearmconnect/sacsshhkey $prefix/sidearmconnect/sacsshpkey $prefix/sidearmconnect/sacfwdkey $prefix/sidearmconnect/sacsshckey $prefix/sidearmconnect/rcvdest $prefix/.ssh
cp "$(echo $pathbase | sed s,/$,,)"/"$keyfile" $prefix/sidearmconnect/sacsshhkey/key
cp "$(echo $pathbase | sed s,/$,,)"/"$keyfile".pub $prefix/sidearmconnect/sacsshpkey/key
echo . > $prefix/prefix
echo $(cd $sprefix && pwd) > $prefix/sprefix
echo $(cd $pprefix && pwd) > $prefix/pprefix
echo $rprefix > $prefix/rprefix
cp cprefix $prefix/cprefix
